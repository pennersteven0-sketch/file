/**
 * @file Firebase Security Rules for ConexPro Firestore database.
 *
 * @Core Philosophy:
 * This ruleset enforces a strict user-ownership model for Clients and their associated Quotes and Jobs.
 * Team Members have read access to Jobs they are assigned to.
 *
 * @Data Structure:
 * - /clients/{clientId}: Stores client information, accessible only by the client themselves.
 * - /clients/{clientId}/quotes/{quoteId}: Stores quotes associated with a client, accessible only by the client.
 * - /clients/{clientId}/jobs/{jobId}: Stores jobs associated with a client. Accessible to the client and assigned team members.
 * - /teamMembers/{teamMemberId}: Stores team member information, accessible only by the team member themselves.
 *
 * @Key Security Decisions:
 * - No user listing is allowed for any collection.
 * - The `teamMemberIds` array on the Job document is used for authorization, allowing team members to access jobs they are assigned to.
 * - All write operations are restricted to authenticated users.
 *
 * @Denormalization for Authorization:
 * - Jobs contain a `teamMemberIds` array to avoid requiring security rules to fetch team member information from a separate collection.
 *   This allows for efficient and secure job access control.
 *
 * @Structural Segregation:
 * - Client-specific data (quotes and jobs) are stored under the /clients/{clientId} path to maintain ownership and access control.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    match /{document=**} {
      allow read, write: if false;
    }

    match /jobs/{jobId} {
      allow read, write: if isSignedIn();
    }

    match /quotes/{quoteId} {
      allow read, write: if isSignedIn();
    }

    match /teamMembers/{teamMemberId} {
      allow read, write: if isSignedIn();
    }
  }
}
